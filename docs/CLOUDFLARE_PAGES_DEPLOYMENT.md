# Cloudflare Pages Deployment Configuration

## Build Configuration

When deploying to Cloudflare Pages, use the following build settings:

### Build Command
```
npm run pages:build
```

This command:
1. Runs `opennextjs-cloudflare build` to build the Next.js app
2. Runs `node scripts/inject-durable-objects.js` to inject Durable Object exports

### Build Output Directory
```
.open-next
```

## Why This Is Needed

Cloudflare Pages needs the Durable Object class (`VotingSession`) to be exported from the worker entrypoint. The post-build script automatically injects this export after the OpenNext build completes.

## Manual Deployment

If deploying manually using Wrangler:

```bash
npm run deploy
```

This runs the same steps as the Pages build command, plus deploys using `opennextjs-cloudflare deploy`.

## Troubleshooting

If you get an error like:
```
Your Worker depends on the following Durable Objects, which are not exported in your entrypoint file: VotingSession
```

This means the post-build injection script didn't run. Make sure:
1. The build command in Cloudflare Pages is set to `npm run pages:build`
2. The script `scripts/inject-durable-objects.js` exists and is executable
3. The `.open-next/worker.js` file is being generated by the OpenNext build

## Verifying the Export

After building, you can verify the export was added:

```bash
grep "export { VotingSession }" .open-next/worker.js
```

This should return a line showing the export if the injection was successful.
